{% extends "base.html" %}
{% block title %}{{film.name}} - MyMovies{% endblock %}

{% block extra_styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
{% endblock %}

{% block content %}
    <section class="film-details-container">
        <div class="film-header">
            <h1 class="film-title">{{ film.name }}</h1>
        </div>

        <div class="film-content-wrapper">
            <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞: –ü–æ—Å—Ç–µ—Ä -->
            <div class="film-poster">
                {% if film.poster %}
                    <img src="{{ film.poster }}" alt="–ü–æ—Å—Ç–µ—Ä {{ film.name }}">
                {% else %}
                    <img src="https://via.placeholder.com/300x450?text=No+Poster" alt="No Poster">
                {% endif %}
            </div>

            <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞: –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
            <div class="film-info-side">
                <div class="film-meta-large">
                    <span title="–†—ñ–∫ –≤–∏—Ö–æ–¥—É">üìÖ {{ film.date.year }}</span>
                    <span title="–†–µ–π—Ç–∏–Ω–≥">‚≠ê {{ film.rating }}/10</span>
                    <span title="–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å">‚è≥ {{ film.duration }} —Ö–≤.</span>
                    <span title="–ñ–∞–Ω—Ä">üé≠ {{ film.genre }}</span>
                    <span title="–ö—Ä–∞—ó–Ω–∞">üåç {{ film.country_name }}</span>
                </div>

                {% if film_actors %}
                <div class="film-actors" style="margin-top: 20px;">
                    <h3>–ê–∫—Ç–æ—Ä–∏:</h3>
                    {% for one_actor in film_actors %}
                        <div class="checkbox-item">
                            <p>{{ one_actor.first_name }} {{ one_actor.last_name }}</p>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="film-description">
                    <h3>–û–ø–∏—Å:</h3>
                    <p>{{ film.description }}</p>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥—ñ–π -->
                <div class="film-actions" style="margin-top: 30px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">

                    <!-- –î–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ —Å–ø–∏—Å–∫—É (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏—Ö) -->
                    {% if session.get('user_id') and user_lists %}
                    <form method="POST" action="{{ url_for('add_to_list', film_id=film.id) }}" style="display: flex; gap: 10px; align-items: center;">
                        <select name="list_id" required style="padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
                            <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å —Å–ø–∏—Å–æ–∫</option>
                            {% for list in user_lists %}
                                <option value="{{ list.id }}">{{ list.name }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-primary" style="padding: 8px 15px;">‚ûï –î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É</button>
                    </form>
                    {% endif %}

                    <form method="GET" action="{{ url_for('film_edit', film_id = film.id)}}">
                        <button type="submit" class="btn btn-success">‚úèÔ∏è –û–Ω–æ–≤–∏—Ç–∏</button>
                    </form>

                    <form method="POST" action="{{ url_for('film_delete', film_id = film.id)}}">
                        <button type="submit" class="btn btn-danger">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                    </form>


                </div>
            </div>
        </div>

        <div class="reviews-section">
            <h3 class="reviews-title">–í—ñ–¥–≥—É–∫–∏ –≥–ª—è–¥–∞—á—ñ–≤</h3>

            <div class="review-form">
                <h4>–ó–∞–ª–∏—à–∏—Ç–∏ —Å–≤—ñ–π –≤—ñ–¥–≥—É–∫</h4>
                <form method="POST" action="{{ url_for('create_film_rating', film_id=film.id) }}">
                    <textarea name="description" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —Å–≤–æ—ó –≤—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ —Ñ—ñ–ª—å–º..." required></textarea>

                    <div class="form-actions" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="rating-input" style="display: flex; align-items: center; gap: 10px;">
                            <label for="grade">–û—Ü—ñ–Ω–∫–∞:</label>
                            <input type="number" name="grade" id="grade" min="1" max="10" value="" required style="width: 60px;">
                            <span>/ 10</span>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: auto;">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
                    </div>
                </form>
            </div>
            <!-- –°–ø–∏—Å–æ–∫ –≤—ñ–¥–≥—É–∫—ñ–≤ -->
            <div class="reviews-list">
                {% if film_feedbacks %}
                    {% for feedback in film_feedbacks %}
                        <div class="review-card">
                            <div class="review-header">
                                <span class="review-author">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {{ feedback.user.login }}</span>
                                <span class="review-rating">‚≠ê {{ feedback.grade }}/10</span>
                            </div>
                            <div class="review-text"> {{ feedback.description }} </div>
                            <div class="review-text">
                                {% if feedback_id %}
                                    {% if session.get('user_id') == feedback.user_id and feedback_id == feedback.id %}
                                        <form method="POST" action="{{ url_for('edit_film_rating', feedback_id=feedback.id, film_id=film.id) }}">
                                            <textarea name="description">{{ feedback.description }}</textarea>
                                            <input type="number" name="grade" value="{{ feedback.grade }}" min="1" max="10">
                                            <button type="submit" class="btn btn-success">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                                            <a href="{{ url_for('film_info', film_id=film.id) }}" class="btn btn-secondary">–°–∫–∞—Å—É–≤–∞—Ç–∏</a>
                                        </form>
                                    {% endif %}
                                {% else %}
                                    {% if session.get('user_id') == feedback.user_id %}
                                        <a href="{{ url_for('edit_film_rating', feedback_id=feedback.id, film_id=film.id) }}" class="btn btn-primary">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                                        <form method="POST" action="{{ url_for('film_ratings_delete', film_id=film.id, feedback_id=feedback.id) }}">
                                            <button type="submit" class="btn btn-danger">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                                        </form>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}

                {% else %}
                    <div style="text-align: center; padding: 40px; color: #777; background: #f9f9f9; border-radius: 10px;">
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">üì≠ –ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –≤—ñ–¥–≥—É–∫—ñ–≤.</p>
                        <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä—à–∏–º, —Ö—Ç–æ –ø–æ–¥—ñ–ª–∏—Ç—å—Å—è –≤—Ä–∞–∂–µ–Ω–Ω—è–º–∏!</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </section>
{% endblock %}